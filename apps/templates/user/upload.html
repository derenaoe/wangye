{% extends "index/layout.html" %}

		{% block title %}上传{% endblock %}
	    {% block css %}
		   .upload{
				width: 600px;
				height: 400px;
				margin: 100px auto;
				border:solid;
				border-color: rgba(100,100,100,0.8);
			}
			.upload-up{
				width: 100%;
				height: 300px;
				line-height: 300px;
				text-align: center;
			}
			.upload-but{
				width: 100%;
                height: 100px;
                line-height: 100px;
                text-align: center;
                background: #d8b49c;
                display: block;
                font-size: 16px;
               border-radius: 5px;
               float: left;
               position: relative;
			}
			.upload-fli{
				display: block;
                width: 100%;
                height: 40px;
                position: absolute;
                left: 0;
                top: 0;
                opacity: 0;
                border-radius: 5px;
			}
		{% endblock %}
		{% block js %}
       <script type="text/javascript">
		var input1 = document.getElementById("upload"); 
 
    if(typeof FileReader==='undefined'){ 
     //result.innerHTML = "抱歉，你的浏览器不支持 FileReader"; 
     input1.setAttribute('disabled','disabled'); 
    }else{ 
     input1.addEventListener('change',readFile,false); 
     /*input1.addEventListener('change',function (e){
     	console.log(this.files);//上传的文件列表
     },false); */
     }
    function readFile(){ 
	var file = this.files[0];//获取上传文件列表中第一个文件
	if(!/image\/\w+/.test(file.type)){
	//图片文件的type值为image/png或image/jpg
		alert("文件必须为图片！");
		return false; 
	} 
	// console.log(file);
	var reader = new FileReader();//实例一个文件对象
	reader.readAsDataURL(file);//把上传的文件转换成url
	//当文件读取成功便可以调取上传的接口
	reader.onload = function(e){ 
		// console.log(this.result);//文件路径
		// console.log(e.target.result);//文件路径
		/*var data = e.target.result.split(',');
		var tp = (file.type == 'image/png')? 'png': 'jpg';
		var imgUrl = data[1];//图片的url，去掉(data:image/png;base64,)
		//需要上传到服务器的在这里可以进行ajax请求
		// console.log(imgUrl);
		// 创建一个 Image 对象 
		var image = new Image();
		// 创建一个 Image 对象 
		// image.src = imgUrl;
		image.src = e.target.result;
		image.onload = function(){
			document.body.appendChild(image);
		}*/

		var image = new Image();
		// 设置src属性 
		image.src = e.target.result;
		var max=200;
		// 绑定load事件处理器，加载完成后执行，避免同步问题
		image.onload = function(){ 
			// 获取 canvas DOM 对象 
			var canvas = document.getElementById("cvs"); 
			// 如果高度超标 宽度等比例缩放 *= 
			/*if(image.height > max) {
				image.width *= max / image.height; 
				image.height = max;
			} */
			// 获取 canvas的 2d 环境对象, 
			var ctx = canvas.getContext("2d"); 
			// canvas清屏 
			ctx.clearRect(0, 0, canvas.width, canvas.height); 
			// 重置canvas宽高
			/*canvas.width = image.width;
			canvas.height = image.height;
			if (canvas.width>max) {canvas.width = max;}*/
			// 将图像绘制到canvas上
			// ctx.drawImage(image, 0, 0, image.width, image.height);
			ctx.drawImage(image, 0, 0, 200, 200);
			// 注意，此时image没有加入到dom之中
		 };  
	  }
    };
           </script>
{% endblock %}
{% block content %}
		<div id="" class="upload">
			<div id="" class="upload-up">
				<img src="img/d18296f485f22eba10aedb286d93ff35dc3a602c1cbc-78MqIo_fw658.png" />
			</div>
			<span id="" class="upload-but">上传
				<input type="file" name="upload" class="upload-fli" id="upload" />
			</span>
		</div>
{% endblock %}
